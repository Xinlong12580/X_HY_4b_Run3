while getopts "y:d:" opt; do
  case $opt in
    y) year="$OPTARG" ;;
    d) dataset="$OPTARG" ;;
    *) echo "Usage: $0 -y year -d dataset" >&2; exit 1 ;;
  esac
done
echo $year $dataset
readarray -t files < <(jq -r .\"$year\".\"$dataset\"[] datasets_XHY4b.json)
> bad_dataset_"$year"_"$dataset".txt
for file in ${files[@]}; do
    echo TRYING TO GET DATASET: $file
	Command="file dataset="$file
	data_name=./files/"$year"_"$dataset""${file//\//_}"
	#echo $Command
	#echo dasgoclient -query "$Command"
	dasgoclient -query "$Command" | tee "$data_name"_tmp.txt
    sflag=$(tail -c 26 "$data_name"_tmp.txt)
    if [ "$sflag" = "unmatched dataset pattern" ]; then
	    echo "$data_name" >> bad_dataset.txt
    else
        sed 's@^@root://cmsxrootd.fnal.gov/@' "$data_name"_tmp.txt > "$data_name".txt
	fi
    rm "$data_name"_tmp.txt
done
echo BAD DATASET OF  "$year" "$dataset":
cat bad_dataset_"$year"_"$dataset".txt
